@prefix : <./deployment#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix chatbot: <./chatbot#> .
@prefix solution: <./solution#> .
@prefix deployment: <./deployment#> .

# Teams Bot Specific Infrastructure
:TeamsInfrastructure a owl:Class ;
    rdfs:subClassOf :InfrastructureComponent ;
    rdfs:label "Teams Infrastructure" ;
    rdfs:comment "Infrastructure components specific to Teams integration" .

:TeamsAuthComponent a :TeamsInfrastructure ;
    rdfs:label "Teams Authentication Component" ;
    :authType "OAuth 2.0" ;
    :requiredScopes "botframework.graph" .

:TeamsChannelComponent a :TeamsInfrastructure ;
    rdfs:label "Teams Channel Component" ;
    :channelType "MS Teams" ;
    :messageTypes "text,adaptive-card" .

# Teams Bot Validation Rules
:TeamsValidationShape a sh:NodeShape ;
    sh:targetClass :TeamsInfrastructure ;
    sh:property [
        sh:path :authType ;
        sh:in ("OAuth 2.0" "Certificate") ;
        sh:minCount 1 ;
        sh:message "Teams components must specify valid auth type."
    ] ;
    sh:property [
        sh:path :requiredScopes ;
        sh:datatype xsd:string ;
        sh:pattern "^(botframework|graph|teams)\\.[a-zA-Z\\.]+$" ;
        sh:minCount 1 ;
        sh:message "Must specify valid Teams API scopes."
    ] .

:TeamsChannelValidation a sh:NodeShape ;
    sh:targetClass :TeamsChannelComponent ;
    sh:property [
        sh:path :channelType ;
        sh:hasValue "MS Teams" ;
        sh:message "Channel type must be MS Teams."
    ] ;
    sh:property [
        sh:path :messageTypes ;
        sh:datatype xsd:string ;
        sh:pattern "^(text|adaptive-card|hero-card)(,(text|adaptive-card|hero-card))*$" ;
        sh:minCount 1 ;
        sh:message "Must specify supported message types."
    ] .

# Teams Bot Deployment Properties
:teamsAppId a owl:DatatypeProperty ;
    rdfs:domain :TeamsInfrastructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Microsoft Teams App ID" .

:teamsAppSecret a owl:DatatypeProperty ;
    rdfs:domain :TeamsInfrastructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Microsoft Teams App Secret (reference only, not value)" .

:teamsManifest a owl:DatatypeProperty ;
    rdfs:domain :TeamsInfrastructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Teams App Manifest location" .

# Teams Bot Security Requirements
:TeamsSecurityShape a sh:NodeShape ;
    sh:targetClass :TeamsInfrastructure ;
    sh:property [
        sh:path :teamsAppSecret ;
        sh:pattern "^op://.*$" ;
        sh:minCount 1 ;
        sh:message "Teams app secret must use 1Password reference."
    ] ;
    sh:property [
        sh:path :teamsManifest ;
        sh:minCount 1 ;
        sh:message "Must specify Teams app manifest location."
    ] .

# Code Location Properties
:codeLocation a owl:DatatypeProperty ;
    rdfs:domain :InfrastructureComponent ;
    rdfs:range xsd:string ;
    rdfs:comment "Root directory containing the code" .

:sourceStructure a owl:ObjectProperty ;
    rdfs:domain :InfrastructureComponent ;
    rdfs:range :SourceStructure .

:SourceStructure a owl:Class ;
    rdfs:label "Source Code Structure" ;
    rdfs:comment "Defines the structure of source code files" .

:mainModule a owl:DatatypeProperty ;
    rdfs:domain :SourceStructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Path to main bot module" .

:configModule a owl:DatatypeProperty ;
    rdfs:domain :SourceStructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Path to configuration module" .

:functionRoot a owl:DatatypeProperty ;
    rdfs:domain :SourceStructure ;
    rdfs:range xsd:string ;
    rdfs:comment "Path to Azure Function entry point" .

# Add Source Structure Validation
:SourceStructureShape a sh:NodeShape ;
    sh:targetClass :SourceStructure ;
    sh:property [
        sh:path :mainModule ;
        sh:minCount 1 ;
        sh:pattern "^bot/.*\\.py$" ;
        sh:message "Main module must be in bot/ directory with .py extension"
    ] ;
    sh:property [
        sh:path :functionRoot ;
        sh:minCount 1 ;
        sh:pattern "^teams-bot/.*\\.py$" ;
        sh:message "Function root must be in teams-bot/ directory with .py extension"
    ] .
